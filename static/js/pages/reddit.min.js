function attemptToLoadCastSdk(){var e=setInterval(function(){if(!chrome.cast||!chrome.cast.isAvailable){}else if(chrome.cast.isAvailable){initializeCastApi();clearInterval(e)}},500)}function loopThroughPics(){setTimeout(function(){var e=pics[i]["url"];var t=pics[i]["type"];var n=pics[i]["title"];loadMedia(e,t,n,function(){i++;if(i<pics.length){loopThroughPics()}else if(i===pics.length){var e=pics[i-1]["id"];getRedditUrls(e,function(){i=0;loopThroughPics()});return}});},LOOPTIMEOUT)}function getRedditUrls(e,t){pics=[];var n=$("#subreddit-val").text();if(!e){appendMessage("Loading image URLs from subreddit...")}var r=document.createElement("a");r.href=window.location;var i=r.pathname;var s=r.search;if(e&&s.length>0){var o="http://www.reddit.com"+i+"/.json"+s+"&after="+e+"&jsonp=?"}else if(e&&s.length===0){var o="http://www.reddit.com"+i+"/.json?after="+e+"&jsonp=?"}else if(!e&&s.length>0){var o="http://www.reddit.com"+i+"/.json"+s+"&jsonp=?"}else if(!e&&s.length===0){var o="http://www.reddit.com"+i+"/.json?jsonp=?"}$.ajax({type:"GET",url:o,contentType:"application/json",dataType:"json",jsonp:"jsonp",success:function(n){if(!n.data.children){appendMessage("Invalid Reddit response.");return}if(!e){appendMessage("Success!")}$.each(n.data.children,function(e,t){var n=t.data.url;var r=t.data.title;var i=t.data.name;if(n.substring(n.length-4)==".jpg"){var s={};s.url=n;s.title=r;s.id=i;s.type="image/jpg";pics.push(s)}else if(n.substring(n.length-4)==".png"){var s={};s.url=n;s.title=r;s.id=i;s.type="image/png";pics.push(s)}else if(n.substring(n.length-4)==".gif"){var s={};s.url=n;s.title=r;s.id=i;s.type="image/gif";pics.push(s)}else if(n.substring(n.length-4)==".jpeg"){var s={};s.url=n;s.title=r;s.id=i;s.type="image/jpg";pics.push(s)}});t()}})}function initializeCastApi(){var e=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID;var t=new chrome.cast.SessionRequest(e);var n=new chrome.cast.ApiConfig(t,sessionListener,receiverListener);chrome.cast.initialize(n,onInitSuccess,onError)}function sessionListener(e){session=e;if(session.media.length!=0){console.log("Found "+session.media.length+" existing media sessions.")}loopThroughPics()}function receiverListener(e){if(e==="available"){launchApp()}else{appendMessage("There are no Chromecasts available.")}}function launchApp(){if(!session){appendMessage("Launching the Chromecast App...");chrome.cast.requestSession(onRequestSessionSuccess,onLaunchError)}}function onRequestSessionSuccess(e){appendMessage("Success!");session=e;loopThroughPics()}function stopApp(){session.stop(onStopAppSuccess,onError)}function loadMedia(e,t,n,r){if(!session){return}var i=new chrome.cast.media.MediaInfo(e);i.metadata=new chrome.cast.media.PhotoMediaMetadata;i.metadata.metadataType=chrome.cast.media.MetadataType.PHOTO;i.contentType=t;i.metadata.subtitle=n;var s=new chrome.cast.media.LoadRequest(i);s.autoplay=true;s.currentTime=0;session.loadMedia(s,onLoadSuccess,onLoadError);changeTitle(n);setTimeout(r(),1e3)}function onLoadSuccess(){}function onLoadError(){console.log("Failed to load image.")}function onInitSuccess(){}function onError(){}function onSuccess(e){}function onStopAppSuccess(){}function mediaCommandSuccessCallback(e){}function onMediaError(e){}function onLaunchError(){if(!session){appendMessage("Error connecting to the Chromecast. Select your device from extension popup.")}}function appendMessage(e){$("#output").append("<p>"+e+"</p>");console.log(JSON.stringify(e))}function changeTitle(e){$("#nowplaying").text(e)}var pics=[];var i=0;var stopCastingButton=$("#stop-casting-button");var session=null;var LOOPTIMEOUT=5e3;$(document).ready(function(){getRedditUrls(null,function(){attemptToLoadCastSdk()});$("#incdec input").val(LOOPTIMEOUT/1e3)});stopCastingButton.click(function(){i=1e6;stopApp()});$("#up").on("click",function(){if(parseInt($("#incdec input").val())<100){var e=parseInt($("#incdec input").val())+1;$("#incdec input").val(e);LOOPTIMEOUT=e*1e3}});$("#down").on("click",function(){if(parseInt($("#incdec input").val())>2){var e=parseInt($("#incdec input").val())-1;$("#incdec input").val(e);LOOPTIMEOUT=e*1e3}});$("#incdec input").change(function(){if(parseInt($("#incdec input").val())>100){$("#incdec input").val(10);LOOPTIMEOUT=100*1e3}else if(parseInt($("#incdec input").val())<2){$("#incdec input").val(2);LOOPTIMEOUT=2*1e3}})